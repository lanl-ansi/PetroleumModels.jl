<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mathematical Model · PetroleumModels</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-367975-10', 'auto');
ga('send', 'pageview', {'page': location.pathname + location.search + location.hash});
</script><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PetroleumModels</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../quickguide/">Getting Started</a></li><li><a class="tocitem" href="../data-format/">Input Data Formats</a></li><li><a class="tocitem" href="../network-data/">Network Data Format</a></li><li><a class="tocitem" href="../result-data/">Result Data Format</a></li><li class="is-active"><a class="tocitem" href>Mathematical Model</a><ul class="internal"><li><a class="tocitem" href="#Steady-State-Petroleum-Flow"><span>Steady State Petroleum Flow</span></a></li><li><a class="tocitem" href="#Steady-State-Pump-Flow"><span>Steady State Pump Flow</span></a></li><li><a class="tocitem" href="#Steady-State-Mathematical-Model"><span>Steady State Mathematical Model</span></a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../formulations/">Network Formulations</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Steady State Specifications</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../ss-specifications/">Problem Specifications</a></li><li><a class="tocitem" href="../objective/">Objective</a></li><li><a class="tocitem" href="../variables/">Variables</a></li><li><a class="tocitem" href="../constraints/">Constraints</a></li></ul></li><li><a class="tocitem" href="../transient-specifications/">Transient Specifications</a></li><li><a class="tocitem" href="../parser/">File IO</a></li></ul></li><li><a class="tocitem" href="../developer/">Developer</a></li><li><a class="tocitem" href="../examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Mathematical Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mathematical Model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/lanl-ansi/PetroleumModels.jl/blob/master/docs/src/math-model.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="The-PetroleumModels-Mathematical-Model"><a class="docs-heading-anchor" href="#The-PetroleumModels-Mathematical-Model">The PetroleumModels Mathematical Model</a><a id="The-PetroleumModels-Mathematical-Model-1"></a><a class="docs-heading-anchor-permalink" href="#The-PetroleumModels-Mathematical-Model" title="Permalink"></a></h1><p>As PetroleumModels implements a variety of petroleum network optimization problems, the implementation is the best reference for precise mathematical formulations.  This section provides a mathematical specification for a prototypical Petroleum Optimal Flow problem, to provide an overview of the typical mathematical models in PetroleumModels.</p><h2 id="Steady-State-Petroleum-Flow"><a class="docs-heading-anchor" href="#Steady-State-Petroleum-Flow">Steady State Petroleum Flow</a><a id="Steady-State-Petroleum-Flow-1"></a><a class="docs-heading-anchor-permalink" href="#Steady-State-Petroleum-Flow" title="Permalink"></a></h2><p>PetroleumModels implements a steady-state model of petroleum flow based on the Bernoulli equations using the Leibenzon relationship that is based on the 1-D hydrodynamic equations for petroleum gas flow in a pipe. In the following paragraphs, a derivation of the steady state equations used in PetroleumModels is shown. To that end, we first assume that the flow is steady. Given this assumption, the mechanical energy conservation equation for the flow of petroleum in a pipe is given by</p><div>\[\frac{d p}{\rho} + \lambda \frac{dx}{D}\frac{u^2}{2} + d \frac{u^2}{2} + gdz = 0.\]</div><p>where <span>$\rho$</span> is pressure, <span>$\lambda$</span> is the hydraulic resistance, <span>$u$</span> is the flow velocity, and <span>$D$</span> is the diameter of the pipe. Because the fluid is weakly compressible and homogeneous, <span>$\rho$</span> is roughly constant and <span>$d p/d x = 0$</span>. Since the pipe diameter is constant, the velocity, <span>$u(x)$</span>, of the fluid is also constant throughout the pipe. In the steady-state equation, the value of <span>$d p/\rho$</span> represents the work of a unit of mass of fluid moving along the area <span>$dx$</span>. This work overcomes the resistive frictional forces of turbulence, the change in fluid kinetic energy, and the lifting of fluid over a height difference, <span>$\Delta z$</span>. After integrating the equation of mechanical energy conservation along the length of the pipe, <span>$L$</span>, the relationship between endpoint pressure variables <span>$p(0)$</span> and <span>$p(L)$</span> and the flow velocity <span>$u$</span> is given by</p><div>\[\frac{p(0) - p(L)}{\rho g} = \lambda \frac{L}{D}\frac{{u}^{2}}{2g}+\Delta z.\]</div><p>The values <span>$h(0)\equiv p(0)/(\rho g)$</span> and <span>$h(L)\equiv p(L)/(\rho g)$</span> denote the heights the liquid is lifted to under the pressures <span>$p(0)$</span> and <span>$p(L)$</span> at either end of the pipe. The value <span>$h$</span> is referred to as head.  A general equation that is used to determine the coefficient of hydraulic resistance <span>$\lambda$</span> is given as follows:</p><div>\[\lambda = \frac{A}{Re^m},\]</div><p>where <span>$A$</span> is the cross-sectional area of the pipe and <span>$m$</span> is a Reynolds constant corresponding to the fluid motion regime. Using <span>$Re = 4q/(\pi D \nu)$</span>, where <span>$q$</span> is the volumetric flow rate and <span>$\nu$</span> is the petroleum kinematic viscosity, we Leibenzon formula is obtained [1]</p><div>\[1.02  \beta \frac{q^{2-m} \nu^m} {D^{5-m}}\]</div><p>For turbulent flow in smooth pipes, parameters of <span>$m$</span> = 0.25 and <span>$\beta$</span> = 0.0246$ (friction factor) is often used. However, the parameter <span>$m$</span> can be adjusted to reflect the laminarization effects of anti-turbulent drag reduction additives that are widely used to facilitate petroleum transport. Given these relationships the total head loss between the ends, <span>$(i,j)$</span>,, of a pipe is equal to the sum of losses caused by friction and the head difference arising from pipeline elevation.</p><div>\[h_i - h_j = z_j - z_i + 1.02 \beta_{ij} \frac{q_{ij}^{2-m} \nu^m}{D_{ij}^{5-m}} L_{ij}   \]</div><p>where <span>$z$</span> is the elevation of the pipe on either end.</p><p>To create a better numerically conditioned problem, it is very useful to non-dimensionalize the units. Here we use a typical head <span>$h_0$</span> and a typical volumetric flow <span>$q_0$</span> and normalize the equations. This yields</p><div>\[  \tilde{h}_i - \tilde{h}_j = \tilde{z}_j - \tilde{z}_i + 1.02 \beta_{ij} \frac{\tilde{q}_{ij}^{2-m} \nu^m} {D_{ij}^{5-m}} L_{ij} * \frac{q_0}{p_0}\]</div><p>where <span>$\tilde{q}=\frac{q}{q_0}$</span>, <span>$\tilde{z}=\frac{z}{h_0}$</span>, and <span>$\tilde{h}=\frac{h}{h_0}$</span> are the dimensionless volumetric flow and head, respectively, and are both of order one. While not strictly necessary in steady-state formulations, length, <span>$L$</span>, can also be made non dimensional in a similar way and is often useful for transient modeling. For notational convenience, the non-dimensionalization constants and pipeline constants (diameter, length, etc.) can be lumped as a single constant <em>resistance</em>, <span>$\gamma=\frac{1.02 \beta \nu^m L q_0}{D^{5-m} h_0}$</span> yielding a non dimensional equation of the form</p><div>\[  \tilde{h}_i - \tilde{h}_j = \tilde{z}_j - \tilde{z}_i + \gamma_{ij} \tilde{q}_{ij}^{2-m}\]</div><h2 id="Steady-State-Pump-Flow"><a class="docs-heading-anchor" href="#Steady-State-Pump-Flow">Steady State Pump Flow</a><a id="Steady-State-Pump-Flow-1"></a><a class="docs-heading-anchor-permalink" href="#Steady-State-Pump-Flow" title="Permalink"></a></h2><p>In liquid pipeline transportation, the flow of the commodity through the system is managed by pumping machinery, which is located at pumping stations throughout the system. PetroleumModels uses a simple relationships between a minimal set of physical and mechanical variables that describe the relationship between rotation frequency, pump efficiency, and flow. The dependence of pump efficiency on flow at nominal rotational speed is modeled by a pump-specific characteristic curve <span>$\eta = f(Q)$</span>. This curve is often approximated analytically using the quadratic function</p><div>\[\eta^{pump} = b_0+b_1 q+b_2 q^2,\]</div><p>where <span>$b_0$</span>, <span>$b_1$</span>, and <span>$b_2$</span> are approximation coefficients obtained by the least squares method and <span>$q$</span> is the flow rate through the pump. We use affinity Laws to define the pump efficiency. The values of the actual and nominal flow rates <span>$q$</span> and <span>$q^{nom}$</span> and heads <span>$h$</span> and <span>$h^{nom}$</span> when operating at actual and nominal rotational pump speeds <span>$\omega$</span> and <span>$\omega^{nom}$</span>, respectively, are related by the ratios</p><div>\[\begin{align}
\frac{q}{q^{nom}} &amp;= \frac{\omega}{\omega^{nom}} \\
\frac{h}{h^{nom}} &amp;= \left(\frac{\omega}{\omega^{nom}}\right)^2
\end{align}\]</div><p>Thus, pump efficiency as a function of rotational speed is then written as</p><div>\[\eta^{pump} = b_0+b_1\frac{q^{nom}}{\omega^{nom}}\omega+b_2\left( \frac{q^{nom}}{\omega^{nom}}\right)^2\omega^2\]</div><p>The laws of affinity require the use of a nominal point on the curve to determine the new rotational speed. PetroleumModels uses the equation given by [2] to provide an analytical relationship between actual and nominal rotational speeds <span>$\omega$</span> and <span>$\omega^{nom}$</span> and corresponding efficiencies <span>$\eta$</span> and <span>$\eta^{nom}$</span>:</p><div>\[\eta = 1 – (1 - \eta^{nom})\left(\frac{\omega^{nom}}{\omega}\right)^{0.1}.\]</div><p>Therefore, for large pumps the change in efficiency can be neglected if the frequency is within 33\% of its nominal value. However, this does not mean the pump will perform at the same efficiency when installed in the pipeline system, because the operating point is determined by the intersection of the pump curve with the system curve. Thus, we model the dependence of pump efficiency on flow at a constant speed using a second-degree polynomial [3]:</p><div>\[\eta^{pump} = b_1 q^{nom}-b_2 (q^{nom})^2,\]</div><p>which is rewritten as</p><div>\[\eta^{pump} = 2\frac{\eta^{nom}}{q^{nom}}q-\frac{\eta^{nom}}{(q^{nom})^2}q^2,\]</div><p>where <span>$\eta^{nom} = b_1^2/(4b_2)$</span> and <span>$q^{nom} = b_1/(2b_2)$</span>. It follows that the dependence of efficiency on the actual flow rate can be approximated with</p><div>\[\eta^{pump} = 2\frac{\eta^{nom}}{q^{nom}}q \frac{\omega^{nom}}{\omega}-\frac{\eta^{nom}}{(q^{nom})^2}q^2 \left(\frac{\omega^{nom}}{\omega}\right)^2.\]</div><p>This equation is transformed using the technique of completing the square to yield</p><div>\[\eta^{pump} = \eta^{nom} - \left(q - q^{nom}\frac{\omega}{\omega^{nom}}\right)^2 \cdot \frac{\eta^{nom}}{(q^{nom})^2} \cdot \left(\frac{\omega^{nom}}{\omega}\right)^2.\]</div><p>Thus, by modulating the power applied to a pump <span>$(i,j)\in \mathcal E_{p}$</span>, it is possible to make the engine drive shaft rotational speed <span>$\omega_{ij}$</span> lower or higher than a nominal value <span>$\omega_{ij}^{nom}$</span>. The relationship between the drive frequency, head difference, and through flow for a variable frequency drive pump can then be approximated by equations</p><div>\[\begin{align}
h_{j} - h_i  = \alpha_{ij}^0 \left(\frac{\omega_{ij}}{\omega_{ij}^{nom}}\right)^2 - \alpha_{ij}^1 Q_{ij}^2\\
\eta_{ij}  = \eta_{ij}^{nom} - \left(\frac{q_{ij}}{q_{ij}^{nom}} - \frac{\omega_{ij}}{\omega_{ij}^{nom}}\right)^2 \eta_{ij}^{nom} \left(\frac{\omega_{ij}^{nom}}{\omega_{ij}}\right)^2
\end{align}\]</div><p>where <span>$a_{ij}^0$</span> and <span>$a_{ij}^1$</span> are constant parameters and  <span>$q_{ij}^{nom}$</span>, <span>$\omega_{ij}^{nom}$</span>, and <span>$\eta_{ij}^{nom}$</span> are nominal values of flow rate, drive shaft frequency, and pumping efficiency, respectively.</p><h2 id="Steady-State-Mathematical-Model"><a class="docs-heading-anchor" href="#Steady-State-Mathematical-Model">Steady State Mathematical Model</a><a id="Steady-State-Mathematical-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Steady-State-Mathematical-Model" title="Permalink"></a></h2><p>A complete petroleum flow mathematical model is the defined by</p><div>\[\begin{aligned}
\text{sets:} \\
&amp; N &amp; \text{junctions} \\
&amp; A^p &amp; \text{pipes}  \\
&amp; A^u &amp; \text{pumps}  \\
&amp; A = A^p \cup A^u &amp; \text{edges }  \\
&amp; P, P_i &amp; \text{producers and producers at junction $i$}   \\
&amp; C, C_i &amp; \text{consumers and consumers at junction $i$}    \\
%
\text{data:} \\
&amp; \gamma_a &amp; \text{lumped resistance factor of pipeline $a$} \\
&amp; ql_j &amp; \text{consumption (mass flow) at consumer $j$} \\
&amp; qg_j &amp; \text{production (mass flow) at producer $j$} \\
&amp; \underline{q}_a=1, \overline{q}_a &amp; \text{limits on volumetric flow of edge $a$} \\
&amp; \underline{\eta}_a=1, \overline{\eta}_a &amp; \text{limits on efficiency of pump $a$} \\
&amp; \underline{w}_a=1, \overline{w}_a &amp; \text{limits on rotation of pump $a$} \\
&amp; \underline{h}_i \ge 0,\overline{h}_i &amp; \text{limits on head at node $i$} \\
&amp; \underline{h}_a \ge 0,\overline{h}_a &amp; \text{limits on head at pump $a$} \\
%
\text{variables:} \\
&amp; h_i &amp; \text{head at node $i$} \\
&amp; q_a &amp; \text{volumetric flow on edge $a$} \\
&amp; \eta &amp; \text{efficiency of pump $a$}\\
&amp; w &amp; \text{rotation speed of pump $a$}\\
%
\text{constraints:} \\
&amp; (h_i - h_j) = z_j - z_i + {\gamma}_{a} q_a^{2-m} &amp;\text{Hydraulic equation for pipe $a$} \\
&amp;&amp; \text{connected from junction $i$ to junction $j$}  \\
&amp;\sum\limits_{a=a_{ij}\in A} q_{a} - \sum\limits_{a=a_{ji} \in A} q_{a} = \sum_{j \in P_i} qg_j- \sum_{j \in C_i} ql_j &amp; \text{volumetric flow balance at junction $i$} \\
&amp; h_i - h_j = \alpha_{a}^0 \left(\frac{\omega_{a}}{\omega_{a}^{nom}}\right)^2 - \alpha_{a}^1 q_{ij}^2 &amp; \text{head boost at pump $a$} \\
&amp;&amp; \text{connected from junction $i$ to junction $j$}  \\
&amp;\eta_{a}  = \eta_{a}^{nom} - \left(\frac{q_{a}}{Q_{a}^{nom}} - \frac{\omega_{a}}{\omega_{a}^{nom}}\right)^2 \eta_{a}^{nom} \left(\frac{\omega_{a}^{nom}}{\omega_{a}}\right)^2 &amp; \text{efficiency of pump $q$} \\
&amp;&amp; \text{connected from junction $i$ to junction $j$}  \\
&amp;\underline{{h}}_i \leq h_i \leq \overline{h}_i &amp; \text{head limits at junction $i$} \\
&amp;\underline{{\omega}}_a \leq \omega_a \leq \overline{\omega}_a &amp; \text{rotation limits at pump $a$} \\
&amp;\underline{{\eta}}_a \leq \eta_a \leq \overline{\eta}_a &amp; \text{efficiency limits at pump $a$} \\
&amp;\underline{{h}}_a \leq h_j - h_i \leq \overline{h}_a &amp; \text{head difference limits at pump $a$} \\
&amp;&amp; \text{connected from junction $i$ to junction $j$}  \\
&amp;\underline{{q}}_a \leq q_a \leq \overline{q}_a &amp; \text{flow limits at edge $a$} \\
\end{aligned}\]</div><p>most of the optimization models of PetroleumModels are variations of this formulation.</p><p>SI Units for various parameters</p><table><tr><th style="text-align: right">Parameter</th><th style="text-align: center">Description</th><th style="text-align: right">SI Units</th></tr><tr><td style="text-align: right"><span>$D$</span></td><td style="text-align: center">Pipe Diameter</td><td style="text-align: right">m</td></tr><tr><td style="text-align: right"><span>$L$</span></td><td style="text-align: center">Pipe Length</td><td style="text-align: right">m</td></tr><tr><td style="text-align: right"><span>$A$</span></td><td style="text-align: center">Pipe Area Cross Section</td><td style="text-align: right">m^2</td></tr><tr><td style="text-align: right"><span>$h$</span></td><td style="text-align: center">Petroleum Head</td><td style="text-align: right">m</td></tr><tr><td style="text-align: right"><span>$\rho$</span></td><td style="text-align: center">Petroleum Density</td><td style="text-align: right">kg/m^3</td></tr><tr><td style="text-align: right"><span>$q$</span></td><td style="text-align: center">Petroleum Volumetric Flow</td><td style="text-align: right">m^3/s</td></tr><tr><td style="text-align: right"><span>$\eta$</span></td><td style="text-align: center">Pump efficiency</td><td style="text-align: right">none</td></tr><tr><td style="text-align: right"><span>$\omega$</span></td><td style="text-align: center">Pump rotation</td><td style="text-align: right">rotations per second</td></tr><tr><td style="text-align: right"><span>$\nu$</span></td><td style="text-align: center">Petroleum Viscosity</td><td style="text-align: right">m^2/s</td></tr><tr><td style="text-align: right"><span>$g$</span></td><td style="text-align: center">Gravity</td><td style="text-align: right">m/s^2</td></tr></table><p>[1] Y. Kuzminskii, S. Shilko, V. Vyun. Mathematical modeling of effect of the anti-turbulent additives on flow rate of oil-pipeline section. Journal of Friction and Wear, 25(3):7–12, 2004.</p><p>[2] I. Sárbu, I. Borza. Energetic optimization of water pumping in distribution systems. Periodica Polytechnica Mechanical Engineering, 42(2):141–152, 1998.</p><p>[3] V. Grishin, A. Grishin. The efficiency of frequency-regulated electric pump. Automation and Informatization of electrified agricultural production. Scientific papers (inRussian). 89:118–127, 2004.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../result-data/">« Result Data Format</a><a class="docs-footer-nextpage" href="../formulations/">Network Formulations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 14 November 2020 00:07">Saturday 14 November 2020</span>. Using Julia version 1.0.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
